{% extends "base.html" %}

{% block title %}Songs · Setlist Manager{% endblock %}

{% block content %}
<section class="panel">
    <header>
        <h2>Your Songs</h2>
    </header>

    {% if songs %}
        <div data-sortable-table>
            <table class="data-table">
                <thead>
                    <tr>
                        <th data-sortable="text">Title</th>
                        <th data-sortable="text">Alias</th>
                        <th data-sortable="text">Artist</th>
                        <th data-sortable="duration">Duration</th>
                        <th data-sortable="text">Tags</th>
                        <th data-sortable="number">Plays</th>
                        <th data-sortable="date">Last Played</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for song_data in songs %}
                        {% set song = song_data.song %}
                        <tr>
                            <td>{{ song.title }}</td>
                            <td>{{ song.alias or '—' }}</td>
                            <td>{{ song.artist }}</td>
                            <td>{{ song.duration_label }}</td>
                            <td>
                                {% if song.tag_summary %}
                                    {{ song.tag_summary }}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td>{{ song_data.play_count }}</td>
                            <td>
                                {% if song_data.last_played %}
                                    {{ song_data.last_played.strftime('%b %d, %Y') }}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td class="actions">
                                <a class="button" href="{{ url_for('setlists.edit_song', song_id=song.id) }}">Edit</a>
                                <form method="post" action="{{ url_for('setlists.delete_song', song_id=song.id) }}" onsubmit="return confirm('Remove this song?');">
                                    <button type="submit" class="danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No songs yet. Add some using the form below.</p>
    {% endif %}
</section>

<section class="panel secondary">
    <header>
        <h2>Add A Song</h2>
    </header>
    <form method="post">
        <label>
            Title
            <input type="text" name="title" required>
        </label>
        <label>
            Artist
            <input type="text" name="artist" required>
        </label>
        <label>
            Alias (print name)
            <input type="text" name="alias" placeholder="Optional">
        </label>
        <label>
            Duration (mm:ss or minutes)
            <input type="text" name="duration" placeholder="3:45 or 3.75" required>
        </label>
        <label>
            Genre
            <input type="text" name="genre" placeholder="Optional">
        </label>
        <label>
            Energy (1-10)
            <input type="number" name="energy" min="1" max="10" placeholder="Optional">
        </label>
        <fieldset class="checkbox-group">
            <legend>Tags</legend>
            <label class="checkbox">
                <input type="checkbox" name="tags" value="M">
                Multitrack (M)
            </label>
            <label class="checkbox">
                <input type="checkbox" name="tags" value="CVR">
                Cover (CVR)
            </label>
            <label class="checkbox">
                <input type="checkbox" name="tags" value="VO">
                Vocals Only (VO)
            </label>
        </fieldset>
        <button type="submit">Save Song</button>
    </form>
</section>

<section class="panel secondary">
    <header>
        <h2>Import From CSV</h2>
    </header>
    <form method="post" action="{{ url_for('setlists.import_songs') }}" enctype="multipart/form-data">
        <label>
            CSV File
            <input type="file" name="csv_file" accept=".csv,text/csv" required>
        </label>
        <p class="hint">
            CSV must include columns: title, artist, duration (mm:ss or minutes).
            Optional columns: alias, genre, energy, tags.
        </p>
        <button type="submit">Upload CSV</button>
    </form>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='sortable-table.js') }}" defer></script>
{% endblock %}
