<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{{ setlist.name }} · Printable Setlist</title>
    <style>
        :root {
            color-scheme: light;
        }
        @page {
            size: Letter portrait;
            margin: 0.15in;
        }
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #fff;
            color: #000;
        }
        .print-wrapper {
            padding: 0.5rem;
            width: 100%;
            max-width: 8.1in;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 0.6rem;
        }
        header p {
            margin: 0;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .print-table {
            width: 100%;
            border-collapse: collapse;
        }
        .print-table td {
            padding: 0.18rem 0.3rem;
            vertical-align: middle;
        }
        .print-table tr {
            page-break-inside: avoid;
        }
        .row-label td {
            text-align: center;
            font-size: 1.05rem;
            font-weight: 700;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            padding-top: 0.5rem;
            padding-bottom: 0.25rem;
        }
        .row-encore td {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.18em;
            padding-top: 0.6rem;
            padding-bottom: 0.3rem;
        }
        .cell-tag {
            width: 2.2rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: #0b5fff;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        .cell-duration {
            width: 2.4rem;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .cell-title {
            font-size: 1.35rem;
            font-weight: 800;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            line-height: 1.05;
            word-break: break-word;
        }
        @media print {
            body {
                margin: 0;
            }
            .encore-divider {
                margin: 1.2rem 0 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="print-wrapper">
        <header>
            <p>{{ setlist.entries|length }} song{% if setlist.entries|length != 1 %}s{% endif %} · Total {{ setlist.total_duration_label }}</p>
        </header>

        {% if segments %}
            <table class="print-table">
                <tbody>
                    {% set ns = namespace(index=0) %}
                    {% for segment in segments %}
                        {% if segment.type == "set" %}
                            <tr class="row-label">
                                <td colspan="3">{{ segment.label|upper }}</td>
                            </tr>
                        {% endif %}
                        {% if segment.type == "encore" %}
                            <tr class="row-encore">
                                <td colspan="3">{{ segment.label|upper }} · {{ segment.total_duration_label }}</td>
                            </tr>
                        {% endif %}
                        {% for song_info in segment.per_song %}
                            {% set entry = song_info.entry %}
                            {% set ns.index = ns.index + 1 %}
                            <tr>
                                <td class="cell-tag">
                                    {% if entry.song.tag_summary %}
                                        {{ entry.song.tag_summary }}
                                    {% else %}
                                        —
                                    {% endif %}
                                </td>
                                <td class="cell-duration">
                                    {% if song_info.is_last and song_info.duration_label %}
                                        {{ song_info.duration_label }}
                                    {% endif %}
                                </td>
                                <td class="cell-title">
                                    {{ (entry.song.alias or entry.song.title)|upper }}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No songs in this setlist yet.</p>
        {% endif %}
    </div>

    <script>
        // Simple auto-print when page loads
        window.addEventListener("load", () => {
            setTimeout(() => {
                window.print();
            }, 100);
        });
    </script>
</body>
</html>
