<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{% block title %}Setlist Manager{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="site-header">
        <h1><a href="{{ url_for('setlists.index') }}">Setlist Manager</a></h1>
        <nav>
            <a href="{{ url_for('setlists.index') }}">Setlists</a>
            <a href="{{ url_for('setlists.create_setlist') }}">New Setlist</a>
            <a href="{{ url_for('setlists.songs') }}">Songs</a>
            <a href="{{ url_for('setlists.stats') }}">Stats</a>
            <div class="dropdown">
                <a href="#" class="dropdown-toggle">
                    Config
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                        <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                    </svg>
                </a>
                <div class="dropdown-menu">
                    <a href="{{ url_for('setlists.export_database') }}" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export Database
                    </a>
                    <a href="{{ url_for('setlists.import_database') }}" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V15"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Import Database
                    </a>
                    <a href="{{ url_for('setlists.import_setlists') }}" class="dropdown-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8L14 2Z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        Import Setlists
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                    {% for category, message in messages %}
                        <li class="flash {{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>
    {% block scripts %}{% endblock %}

    <script>
    // Dropdown functionality with viewport detection
    document.addEventListener('DOMContentLoaded', function() {
        const dropdowns = document.querySelectorAll('.site-header nav .dropdown');

        dropdowns.forEach(dropdown => {
            const toggle = dropdown.querySelector('.dropdown-toggle');
            const menu = dropdown.querySelector('.dropdown-menu');

            if (!toggle || !menu) return;

            // Function to check and adjust dropdown position
            function adjustDropdownPosition() {
                // Remove any existing viewport classes
                menu.classList.remove('viewport-right', 'viewport-left');

                // Get dropdown and menu dimensions
                const dropdownRect = dropdown.getBoundingClientRect();
                const menuRect = menu.getBoundingClientRect();
                const viewportWidth = window.innerWidth;

                // Check if dropdown would go off the right side
                if (dropdownRect.left + menuRect.width > viewportWidth) {
                    menu.classList.add('viewport-right');
                }
                // Check if dropdown would go off the left side (for small screens)
                else if (dropdownRect.left < menuRect.width / 2) {
                    menu.classList.add('viewport-left');
                }
            }

            // Toggle dropdown
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                // Close all other dropdowns
                document.querySelectorAll('.dropdown-menu.show').forEach(otherMenu => {
                    if (otherMenu !== menu) {
                        otherMenu.classList.remove('show');
                    }
                });

                const isShowing = menu.classList.contains('show');

                if (!isShowing) {
                    // Show dropdown and adjust position
                    menu.classList.add('show');
                    // Small delay to ensure menu is rendered before measuring
                    setTimeout(adjustDropdownPosition, 10);
                } else {
                    menu.classList.remove('show');
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target)) {
                    menu.classList.remove('show');
                }
            });

            // Close dropdown when pressing Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    menu.classList.remove('show');
                }
            });

            // Adjust position on window resize
            window.addEventListener('resize', function() {
                if (menu.classList.contains('show')) {
                    adjustDropdownPosition();
                }
            });
        });
    });
    </script>
</body>
</html>
